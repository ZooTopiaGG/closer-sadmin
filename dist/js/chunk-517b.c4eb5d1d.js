(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-517b"],{"28d1":function(e,t,n){},"37f9":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex flex-v",attrs:{id:"permission"}},[n("div",{staticClass:"permission_title"},[e._v("权限设置")]),n("div",{staticClass:"permission_table flex-1"},[n("div",{staticClass:"permission_table_top flex flex-pack-justify"},[n("div",{staticClass:"flex flex-align-center"},[n("span",{staticClass:"labelname"},[e._v("\n          用户（员工）手机号\n        ")]),n("el-input",{attrs:{maxlength:"11",placeholder:"请输入用户手机号"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.bindSearch(t):null}},model:{value:e.state4,callback:function(t){e.state4=t},expression:"state4"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.bindSearch},slot:"append"})],1)],1),n("el-dialog",{attrs:{title:e.title,visible:e.outerVisible},on:{"update:visible":function(t){e.outerVisible=t}}},[n("el-form",{staticClass:"dialog-content",attrs:{disabled:e.disabled}}),2===e.operationtype?n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.outerVisible=!1}}},[e._v("确定")])],1):n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.outerVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.modifyPermission}},[e._v("保 存")])],1)],1)],1),n("div",{staticClass:"permission_table_content"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userList.data}},[n("el-table-column",{attrs:{fixed:"",prop:"username",label:"用户名"}}),n("el-table-column",{attrs:{prop:"phone",label:"手机号"}}),n("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),n("el-table-column",{attrs:{prop:"newUser",label:"员工状态"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.authUser&&1===e.authUser.type?n("div",[n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){e.permissionModify(t.row,"修改")}}},[e._v("修改")]),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){e.permissionDelete(t.row)}}},[e._v("删除")])],1):e.authUser&&e.authUser.permissions&&e.authUser.permissions.permission?n("div",e._l(e.authUser.permissions.permission,function(i,s){return n("el-button",{key:s,attrs:{type:"text",size:"medium"},on:{click:function(n){e.permissionModify(t.row,i.name)}}},[e._v(e._s(i.name))])})):e._e()]}}])})],1)],1)]),e.userList.count>0?n("div",{staticClass:"block"},[n("el-pagination",{attrs:{"current-page":e.pagenum,"page-size":e.pagesize,layout:"total, prev, pager, next, jumper",total:e.userList.count},on:{"current-change":e.handleCurrentChange}})],1):e._e()])},s=[];n("ac6a");function r(e){if(Array.isArray(e))return e}function a(e,t){var n=[],i=!0,s=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(i=(a=c.next()).done);i=!0)if(n.push(a.value),t&&n.length===t)break}catch(e){s=!0,r=e}finally{try{i||null==c["return"]||c["return"]()}finally{if(s)throw r}}return n}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t){return r(e)||a(e,t)||c()}n("96cf");var u=n("3040"),l=n("c93e"),h=n("2f62"),p={name:"permission",computed:Object(l["a"])({authUser:function(){return this.$store.state.authUser}},Object(h["c"])("permission",{userList:function(e){return e.userList}})),data:function(){return{state4:"",operationtype:0,pagenum:1,pagesize:10,outerVisible:!1,title:"添加账号",phonenum:"",checked:!0,nosearch:!1,searchuserinfo:null,scope_row:{},username_visible:!0,phone_visible:!0,u_username:"",u_phone:"",activeName:"Boss",blurCheckRegion:!1,permissionlist:[],regionlist:[],checkListCity:[],checkListColumn:[],checkListColumn2:[],checkListPermission:[],checkListLog:[],checkContent:[],checkListFinance:[],checkListData:[],checkListActivity:[],checkListActivityData:[],contentChecked:!1,tableData:[{name:"王小虎",phone:"18380464276",createTime:"2016-05-02",newUser:1},{name:"王小虎",phone:"18380464276",createTime:"2016-05-02",newUser:0}],disabled:!1}},created:function(){var e=this,t={page:1,count:10,phone:""};e.getUserList(t)},methods:Object(l["a"])({},Object(h["b"])("permission",["getUserList"]),{bindSearch:function(){this.pagenum=1,this.searchadminlistbyphone()},handleCurrentChange:function(e){this.pagenum=e,this.u_phone="",this.getUserList()},handleClick1:function(e,t){},handleSelect2:function(e){this.checkListPermission=[],e&&e.length>0&&(this.checkListPermission[0]=e[e.length-1])},handleSelect4:function(e){this.checkListData=[],e&&e.length>0&&(this.checkListData[0]=e[e.length-1])},handleSelect5:function(e){this.checkListActivity=[],e&&e.length>0&&(this.checkListActivity[0]=e[e.length-1])},handleSelect6:function(e){this.checkListActivityData=[],e&&e.length>0&&(this.checkListActivityData[0]=e[e.length-1])},handleSelect3:function(e){this.checkListFinance=[],e&&e.length>0&&(this.checkListFinance[0]=e[e.length-1])},handleSelect1:function(){this.blurCheckRegion=this.checkListColumn2.length>0},handleSelect:function(e){},permissionDelete:function(e){var t=this,n="确认删除？";t.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.deleteUser(e)}).catch(function(){t.$message({type:"info",message:"已取消操作"})})},deleteUser:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(t){var n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=this,e.prev=1,i={userId:t.id},e.next=5,n.$axios.$post("".concat(api.admin.delete),i);case 5:if(s=e.sent,0!==s.code){e.next=14;break}return n.$message.success("删除成功！"),n.u_phone="",n.pagenum=1,e.next=12,n.getUserList();case 12:e.next=15;break;case 14:n.$message.error(s.result);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](1),n.$message.error(e.t0);case 20:case"end":return e.stop()}},e,this,[[1,17]])}));return function(t){return e.apply(this,arguments)}}(),getPermissionList:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(t){var n,i,s,r,a,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=this,e.prev=1,i={keywords:"",pagenum:1,pagesize:100},e.next=5,Promise.all([n.$axios.$get("".concat(api.admin.menulist)),n.$axios.$post("".concat(api.region.regions),i)]);case 5:s=e.sent,r=o(s,2),a=r[0],c=r[1],0===a.code?(n.permissionlist=a.result,n.regionlist=c.result.data,t()):n.$message.error(a.result),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),n.$message.error(e.t0);case 15:case"end":return e.stop()}},e,this,[[1,12]])}));return function(t){return e.apply(this,arguments)}}(),permissionModify:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(t,n){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=this,i.username_visible=!0,i.phone_visible=!0,i.checkListColumn=[],i.checkListPermission=[],i.checkListData=[],i.checkListActivity=[],i.checkListActivityData=[],i.checkListLog=[],i.checkListCity=[],i.checkContent=[],i.checkListFinance=[],i.scope_row=t,e.next=15,i.getPermissionList();case 15:i.u_username=t.username,i.u_phone=t.phone,"{}"!=JSON.stringify(t.permissions)&&(t.permissions.permission&&(i.checkListPermission=t.permissions.permission.map(function(e){return e.id})),t.permissions.city&&(i.checkListCity=t.permissions.city.map(function(e){return e.id})),t.permissions.content&&(i.checkContent=t.permissions.content.map(function(e){return e.id})),t.columnCity&&(i.checkListColumn=JSON.parse(t.columnCity)),t.permissions.finance&&(i.checkListFinance=t.permissions.finance.map(function(e){return e.id})),t.permissions.log&&(i.checkListLog=t.permissions.log.map(function(e){return e.id})),t.permissions.data&&(i.checkListData=t.permissions.data.map(function(e){return e.id})),t.permissions.activity&&(i.checkListActivity=t.permissions.activity.map(function(e){return e.id})),t.permissions.activity_data&&(i.checkListActivityData=t.permissions.activity_data.map(function(e){return e.id}))),"修改"===n?(i.title="修改账号",i.operationtype=1,i.disabled=!1):(i.disabled=!0,i.title="查看账号",i.operationtype=2),i.outerVisible=!0;case 20:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),modifyPermission:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this,e.next=3,t.checkListPermission.concat(t.checkListCity,t.checkListFinance,t.checkListLog,t.checkListData,t.checkListActivity,t.checkListActivityData,t.checkContent);case 3:if(n=e.sent,console.log("persarr-====",n),$async.isPhoneNum(t.u_phone)){e.next=8;break}return t.$message.error("手机号格式错误！"),e.abrupt("return");case 8:return e.prev=8,i={id:t.scope_row.id,phone:t.u_phone,username:t.u_username,columnCity:t.checkListColumn,permissions:n},e.next=12,t.$axios.$post("".concat(api.admin.update),i);case 12:if(s=e.sent,0!==s.code){e.next=21;break}return t.$message.success("用户信息或权限修改成功！"),t.u_phone="",e.next=18,t.getUserList();case 18:t.outerVisible=!1,e.next=22;break;case 21:t.$message.error(s.result);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e["catch"](8),t.$message.error(e.t0);case 27:case"end":return e.stop()}},e,this,[[8,24]])}));return function(){return e.apply(this,arguments)}}(),searchadminbyphone:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this,""!=t.phonenum){e.next=4;break}return t.$message.warning("请输入手机号"),e.abrupt("return");case 4:if($async.isPhoneNum(t.phonenum)){e.next=7;break}return t.$message.warning("手机号格式不对"),e.abrupt("return");case 7:return e.prev=7,n={phone:t.phonenum},e.next=11,t.$axios.$post("".concat(api.admin.searchuser),n);case 11:i=e.sent,0===i.code?(t.searchuserinfo=i.result,t.nosearch=!0,t.$message.success("操作成功！")):t.$message.error(i.result),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](7),t.$message.error(e.t0);case 18:case"end":return e.stop()}},e,this,[[7,15]])}));return function(){return e.apply(this,arguments)}}(),searchadminlistbyphone:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this,""==t.state4){e.next=5;break}if($async.isPhoneNum(t.state4)){e.next=5;break}return t.$message.warning("手机号格式不对"),e.abrupt("return");case 5:return t.u_phone=t.state4,e.next=8,t.getUserList();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}),mounted:function(){console.log(this.userList),this.activeName=this.authUser&&1===this.authUser.type?"Boss":"其他"}},m=p,f=(n("70c8"),n("def2"),n("2877")),d=Object(f["a"])(m,i,s,!1,null,"5d375e1a",null);d.options.__file="index.vue";t["default"]=d.exports},"70c8":function(e,t,n){"use strict";var i=n("28d1"),s=n.n(i);s.a},"7e2a":function(e,t,n){},def2:function(e,t,n){"use strict";var i=n("7e2a"),s=n.n(i);s.a}}]);
//# sourceMappingURL=chunk-517b.c4eb5d1d.js.map